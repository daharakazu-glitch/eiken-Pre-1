<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eiken Pre-1 Practice App (Day 2)</title>
    <!-- Bootstrap 5 CDN for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', 'Noto Sans JP', sans-serif;
            background-color: #f0f2f5;
            color: #333;
            padding-bottom: 60px;
        }
        .header-section {
            background: linear-gradient(135deg, #0d6efd, #0a58ca);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        .card-header {
            background-color: #fff;
            border-bottom: 1px solid #eee;
            font-weight: 700;
            padding: 1rem 1.5rem;
        }
        .comic-container {
            background-color: #fff;
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .comic-img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }
        .timer-box {
            background-color: #212529;
            color: #00ff00; /* Digital clock green */
            font-family: 'Courier New', monospace;
            font-size: 2.5rem;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 8px;
            display: inline-block;
            margin-bottom: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .model-answer-box {
            background-color: #e9ecef;
            border-left: 5px solid #0d6efd;
            padding: 15px;
            margin-top: 15px;
            display: none; /* Hidden by default */
            border-radius: 0 5px 5px 0;
        }
        .advice-badge {
            background-color: #ffc107;
            color: #000;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-bottom: 10px;
            display: inline-block;
        }
        .record-interface {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #dee2e6;
        }
        .btn-circle {
            width: 50px;
            height: 50px;
            border-radius: 25px;
            padding: 0;
            line-height: 50px;
            text-align: center;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <div class="header-section text-center">
        <div class="container">
            <h1>è‹±æ¤œæº–1ç´š äºŒæ¬¡è©¦é¨“å¯¾ç­–</h1>
            <p class="lead mb-0">Practical English Proficiency Test Grade Pre-1 (Day 2)</p>
        </div>
    </div>

    <div class="container">
        
        <!-- Part 1: Narration Section -->
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span class="fs-5 text-primary">Part 1: Narration</span>
                        <span class="badge bg-secondary">Preparation: 1 min / Narration: 2 mins</span>
                    </div>
                    <div class="card-body">
                        
                        <!-- Instruction -->
                        <div class="alert alert-primary d-flex align-items-center" role="alert">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-info-circle-fill flex-shrink-0 me-2" viewBox="0 0 16 16">
                                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                            </svg>
                            <div>
                                <strong>Start with:</strong> "One day, an old lady was having a birthday party at her home."
                            </div>
                        </div>

                        <!-- Comic Image Area -->
                        <div class="comic-container mb-4">
                            <!-- User needs to save screenshot as comic.jpg -->
                            <img src="comic.jpg" alt="Please save the comic as comic.jpg" class="comic-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                            <div style="display:none; color: #6c757d;">
                                <h5>ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h5>
                                <p>PDFã®4ã‚³ãƒæ¼«ç”»ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã—ã€<br><strong>comic.jpg</strong> ã¨ã„ã†åå‰ã§ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜å ´æ‰€ã«ä¿å­˜ã—ã¦ãã ã•ã„ã€‚</p>
                            </div>
                        </div>

                        <!-- Timers -->
                        <div class="row text-center mb-4">
                            <div class="col-md-6 mb-3">
                                <h6>Preparation Timer</h6>
                                <div id="timer-prep" class="timer-box">01:00</div>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm" onclick="startTimer('timer-prep', 60)">Start (1 min)</button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="resetTimer('timer-prep', 60)">Reset</button>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <h6>Narration Timer</h6>
                                <div id="timer-narr" class="timer-box">02:00</div>
                                <div>
                                    <button class="btn btn-outline-danger btn-sm" onclick="startTimer('timer-narr', 120)">Start (2 min)</button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="resetTimer('timer-narr', 120)">Reset</button>
                                </div>
                            </div>
                        </div>

                        <!-- Recording Tool -->
                        <div class="record-interface text-center">
                            <h6><i class="bi bi-mic-fill"></i> Voice Recorder (Self Check)</h6>
                            <p class="small text-muted mb-2">è‡ªåˆ†ã®å£°ã‚’éŒ²éŸ³ã—ã¦ã€æ™‚åˆ¶ã‚„ä¸‰å˜ç¾ã®Sã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã—ã‚‡ã†ã€‚</p>
                            <button id="rec-btn-1" class="btn btn-danger rounded-pill px-4" onclick="toggleRecording(1)">ğŸ”´ éŒ²éŸ³é–‹å§‹</button>
                            <div class="mt-2">
                                <audio id="audio-1" controls style="display:none; width: 100%; max-width: 400px; margin: 10px auto;"></audio>
                            </div>
                        </div>

                        <!-- Model Answer & Advice -->
                        <div class="d-grid gap-2 mt-4">
                            <button class="btn btn-dark" type="button" onclick="toggleAnswer('model-narration')">
                                ğŸ‘ï¸ æ¨¡ç¯„è§£ç­”ã¨è§£èª¬ã‚’è¡¨ç¤º (Model Answer)
                            </button>
                        </div>

                        <div id="model-narration" class="model-answer-box">
                            <div class="advice-badge">Narration Script</div>
                            <p class="eng-text" id="text-narration">
                                One day, an old lady was having a birthday party at her home. Her son gave her a present. When she opened it, she found that it was a brand-new cell phone. She looked happy and thanked him for the gift.<br><br>
                                The next day, at her house, the woman tried to use the phone, but she looked confused. She complained to her son that it was too complicated to use and told him that she didn't need a cell phone. Her son looked disappointed to hear that.<br><br>
                                Two weeks later, the woman went hiking in the mountains by herself. While she was walking down a path, she accidentally slipped on the ground and fell down. She seemed to be in pain and couldn't stand up.<br><br>
                                A moment later, she remembered the phone. She used it to call emergency services. She was relieved to see that rescue workers were contacted. She realized that having the cell phone was very helpful after all.
                            </p>
                            <button class="btn btn-sm btn-success mb-3" onclick="speakText('text-narration')">ğŸ”Š éŸ³å£°å†ç”Ÿ (Listen)</button>
                            
                            <hr>
                            <div class="mt-3">
                                <h6><span class="badge bg-warning text-dark">Advice Points</span></h6>
                                <ul class="small text-muted">
                                    <li><strong>é–“æ¥è©±æ³•ã‚’ä½¿ã†:</strong> "I don't need..." â†’ "She told him that she didn't need..."</li>
                                    <li><strong>æ„Ÿæƒ…ã‚’æå†™ã™ã‚‹:</strong> happy, confused, disappointed, relieved, in pain ãªã©ã€‚</li>
                                    <li><strong>ã¤ãªãè¨€è‘‰(Discourse Markers):</strong> The next day, Two weeks later, A moment later ã‚’å¿…ãšå…¥ã‚Œã‚‹ã€‚</li>
                                </ul>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Part 2: Q&A Section -->
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center bg-success text-white">
                        <span class="fs-5">Part 2: Q&A</span>
                    </div>
                    <div class="card-body">
                        
                        <!-- Question 1 -->
                        <div class="mb-5 border-bottom pb-4">
                            <h5><span class="badge bg-success me-2">No. 1</span> Social Skills & IT</h5>
                            <p class="fw-bold fs-5 my-3">
                                "Do you think that young people are losing their social skills because of information technology?"
                            </p>

                            <!-- Recorder for Q1 -->
                            <div class="d-flex align-items-center gap-2 mb-3">
                                <button id="rec-btn-2" class="btn btn-outline-danger btn-sm rounded-pill" onclick="toggleRecording(2)">ğŸ”´ ç·´ç¿’éŒ²éŸ³</button>
                                <audio id="audio-2" controls style="display:none; height: 30px;"></audio>
                            </div>

                            <button class="btn btn-outline-dark btn-sm" onclick="toggleAnswer('ans-q1')">è§£ç­”ä¾‹ã‚’è¡¨ç¤º</button>

                            <div id="ans-q1" class="model-answer-box">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Option A: Yes (å¤±ã£ã¦ã„ã‚‹)</strong></p>
                                        <p class="small" id="text-q1-yes">Yes, I think so. Many young people spend too much time communicating through text messages or social media. As a result, they have fewer opportunities to talk face-to-face, which makes them feel awkward or anxious when interacting with others in real life.</p>
                                        <button class="btn btn-sm btn-success" onclick="speakText('text-q1-yes')">ğŸ”Š Yes</button>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Option B: No (å¤±ã£ã¦ã„ãªã„)</strong></p>
                                        <p class="small" id="text-q1-no">No, I don't think so. Technology actually helps young people stay connected with friends and meet new people from all over the world. They simply communicate in a different way, but they still build strong relationships and learn how to interact with others effectively.</p>
                                        <button class="btn btn-sm btn-success" onclick="speakText('text-q1-no')">ğŸ”Š No</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Question 2 -->
                        <div class="mb-2">
                            <h5><span class="badge bg-success me-2">No. 2</span> Busier Life & Tech</h5>
                            <p class="fw-bold fs-5 my-3">
                                "Do you think that new technology like e-mail has made us busier than before?"
                            </p>

                            <!-- Recorder for Q2 -->
                            <div class="d-flex align-items-center gap-2 mb-3">
                                <button id="rec-btn-3" class="btn btn-outline-danger btn-sm rounded-pill" onclick="toggleRecording(3)">ğŸ”´ ç·´ç¿’éŒ²éŸ³</button>
                                <audio id="audio-3" controls style="display:none; height: 30px;"></audio>
                            </div>

                            <button class="btn btn-outline-dark btn-sm" onclick="toggleAnswer('ans-q2')">è§£ç­”ä¾‹ã‚’è¡¨ç¤º</button>

                            <div id="ans-q2" class="model-answer-box">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Option A: Yes (å¿™ã—ããªã£ãŸ)</strong></p>
                                        <p class="small" id="text-q2-yes">Yes, definitely. Because of smartphones and e-mail, people are expected to reply to messages instantly, even on weekends or at night. This makes it difficult for people to relax and separate their work life from their private life.</p>
                                        <button class="btn btn-sm btn-success" onclick="speakText('text-q2-yes')">ğŸ”Š Yes</button>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Option B: No (ãã†ã§ã‚‚ãªã„)</strong></p>
                                        <p class="small" id="text-q2-no">No, I don't think so. Technology has made many tasks much faster and more efficient. For example, we can send documents instantly without going to the post office. This actually saves us time and allows us to focus on other important things.</p>
                                        <button class="btn btn-sm btn-success" onclick="speakText('text-q2-no')">ğŸ”Š No</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="text-center text-muted mt-4 mb-5">
            <small>Based on the provided Day 2 & Advice materials. Generated for Educational Use.</small>
        </div>

    </div>

    <!-- Scripts -->
    <script>
        // --- Timer Logic ---
        let intervals = {};

        function startTimer(id, seconds) {
            // Clear existing timer if any
            if(intervals[id]) clearInterval(intervals[id]);
            
            const display = document.getElementById(id);
            let timeLeft = seconds;

            updateDisplay(display, timeLeft);

            intervals[id] = setInterval(() => {
                timeLeft--;
                updateDisplay(display, timeLeft);

                if (timeLeft < 0) {
                    clearInterval(intervals[id]);
                    display.textContent = "TIME UP";
                    display.style.color = "red";
                    // Play a beep sound could go here
                }
            }, 1000);
        }

        function resetTimer(id, seconds) {
            if(intervals[id]) clearInterval(intervals[id]);
            const display = document.getElementById(id);
            updateDisplay(display, seconds);
            display.style.color = "#00ff00";
        }

        function updateDisplay(element, seconds) {
            if(seconds < 0) return;
            let m = Math.floor(seconds / 60);
            let s = seconds % 60;
            element.textContent = 
                (m < 10 ? "0" + m : m) + ":" + 
                (s < 10 ? "0" + s : s);
        }

        // --- Toggle Display ---
        function toggleAnswer(id) {
            const el = document.getElementById(id);
            if (el.style.display === "none" || el.style.display === "") {
                el.style.display = "block";
                // Smooth scroll to answer
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                el.style.display = "none";
            }
        }

        // --- Text to Speech ---
        function speakText(elementId) {
            const text = document.getElementById(elementId).innerText;
            if ('speechSynthesis' in window) {
                // Cancel current speaking
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 1.0; // Normal speed
                
                // Try to find a good English voice
                const voices = window.speechSynthesis.getVoices();
                // Prefer Google US English or Microsoft Zira if available
                const preferredVoice = voices.find(voice => 
                    voice.name.includes('Google US English') || 
                    voice.name.includes('Zira') ||
                    (voice.lang === 'en-US')
                );
                if(preferredVoice) utterance.voice = preferredVoice;

                window.speechSynthesis.speak(utterance);
            } else {
                alert("This browser does not support Text-to-Speech.");
            }
        }

        // --- Recording Logic ---
        let mediaRecorders = {};
        let audioChunks = {};

        async function toggleRecording(id) {
            const btn = document.getElementById(`rec-btn-${id}`);
            const audioPlayer = document.getElementById(`audio-${id}`);
            
            // If currently recording (Button says Stop)
            if (btn.classList.contains('recording')) {
                mediaRecorders[id].stop();
                btn.innerHTML = "ğŸ”´ éŒ²ã‚Šç›´ã™";
                btn.classList.remove('recording', 'btn-warning');
                btn.classList.add('btn-outline-danger');
            } 
            // Start recording
            else {
                // Request microphone permission
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    mediaRecorders[id] = new MediaRecorder(stream);
                    audioChunks[id] = [];

                    mediaRecorders[id].addEventListener("dataavailable", event => {
                        audioChunks[id].push(event.data);
                    });

                    mediaRecorders[id].addEventListener("stop", () => {
                        const audioBlob = new Blob(audioChunks[id], { type: 'audio/wav' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        audioPlayer.src = audioUrl;
                        audioPlayer.style.display = 'block';
                        
                        // Stop all tracks to release mic
                        stream.getTracks().forEach(track => track.stop());
                    });

                    mediaRecorders[id].start();
                    btn.innerHTML = "â¹ï¸ åœæ­¢";
                    btn.classList.add('recording', 'btn-warning');
                    btn.classList.remove('btn-danger', 'btn-outline-danger');
                    
                } catch (err) {
                    console.error("Error accessing microphone:", err);
                    alert("ãƒã‚¤ã‚¯ã®ä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚\n(Chromeã®å ´åˆã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã®éµãƒãƒ¼ã‚¯ã‹ã‚‰è¨­å®šã§ãã¾ã™)");
                }
            }
        }
    </script>
</body>
</html>